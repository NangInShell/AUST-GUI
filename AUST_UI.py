# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'AUST_UI.ui'
#
# Created by: PyQt5 UI code generator 5.15.4
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.


from typing import Optional
from PyQt5 import QtCore, QtGui, QtWidgets
from PyQt5.QtGui import *
from PyQt5.QtCore import *
from PyQt5.QtWidgets import *
from pynvml import *


class Ui_Form(object):
    def setupUi(self, Form):
        Form.setObjectName("Form")
        Form.resize(1286, 905)
        self.horizontalLayout = QtWidgets.QHBoxLayout(Form)
        self.horizontalLayout.setObjectName("horizontalLayout")
        self.widget_4 = QtWidgets.QWidget(Form)
        self.widget_4.setObjectName("widget_4")
        self.verticalLayout_2 = QtWidgets.QVBoxLayout(self.widget_4)
        self.verticalLayout_2.setObjectName("verticalLayout_2")
        self.widget_2 = QtWidgets.QWidget(self.widget_4)
        self.widget_2.setObjectName("widget_2")
        self.gridLayout = QtWidgets.QGridLayout(self.widget_2)
        self.gridLayout.setObjectName("gridLayout")
        self.widget = QtWidgets.QWidget(self.widget_2)
        self.widget.setMinimumSize(QtCore.QSize(500, 0))
        self.widget.setObjectName("widget")
        self.verticalLayout = QtWidgets.QVBoxLayout(self.widget)
        self.verticalLayout.setObjectName("verticalLayout")
        self.label_input = QtWidgets.QLabel(self.widget)
        self.label_input.setObjectName("label_input")
        self.verticalLayout.addWidget(self.label_input)
        self.in_path = MListWidget(self.widget)
        self.in_path.setAcceptDrops(True)
        self.in_path.setObjectName("in_path")
        self.verticalLayout.addWidget(self.in_path)
        self.label_output = QtWidgets.QLabel(self.widget)
        self.label_output.setMaximumSize(QtCore.QSize(16777215, 30))
        self.label_output.setObjectName("label_output")
        self.verticalLayout.addWidget(self.label_output)
        self.out_path = MLineEdit(self.widget)
        self.out_path.setMinimumSize(QtCore.QSize(0, 40))
        self.out_path.setText("")
        self.out_path.setObjectName("out_path")
        self.verticalLayout.addWidget(self.out_path)
        self.gridLayout.addWidget(self.widget, 0, 0, 1, 1)
        self.tabWidget = QtWidgets.QTabWidget(self.widget_2)
        self.tabWidget.setMinimumSize(QtCore.QSize(600, 400))
        self.tabWidget.setMaximumSize(QtCore.QSize(500, 400))
        self.tabWidget.setObjectName("tabWidget")
        self.tab = QtWidgets.QWidget()
        self.tab.setObjectName("tab")
        self.Box_device = QtWidgets.QComboBox(self.tab)
        self.Box_device.setGeometry(QtCore.QRect(130, 280, 411, 41))
        self.Box_device.setObjectName("Box_device")
        self.label_device = QtWidgets.QLabel(self.tab)
        self.label_device.setGeometry(QtCore.QRect(30, 280, 71, 31))
        self.label_device.setObjectName("label_device")
        self.label_model = QtWidgets.QLabel(self.tab)
        self.label_model.setGeometry(QtCore.QRect(210, 10, 71, 31))
        self.label_model.setObjectName("label_model")
        self.Box_method = QtWidgets.QComboBox(self.tab)
        self.Box_method.setGeometry(QtCore.QRect(20, 40, 151, 41))
        self.Box_method.setObjectName("Box_method")
        self.Box_method.addItem("")
        self.Box_model = QtWidgets.QComboBox(self.tab)
        self.Box_model.setGeometry(QtCore.QRect(210, 40, 331, 41))
        self.Box_model.setObjectName("Box_model")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.Box_model.addItem("")
        self.label_method = QtWidgets.QLabel(self.tab)
        self.label_method.setGeometry(QtCore.QRect(20, 10, 81, 31))
        self.label_method.setObjectName("label_method")
        self.label_scale = QtWidgets.QLabel(self.tab)
        self.label_scale.setGeometry(QtCore.QRect(20, 110, 71, 31))
        self.label_scale.setObjectName("label_scale")
        self.label_alpha = QtWidgets.QLabel(self.tab)
        self.label_alpha.setGeometry(QtCore.QRect(350, 110, 71, 31))
        self.label_alpha.setStyleSheet("")
        self.label_alpha.setObjectName("label_alpha")
        self.label_cache = QtWidgets.QLabel(self.tab)
        self.label_cache.setGeometry(QtCore.QRect(240, 110, 71, 31))
        self.label_cache.setObjectName("label_cache")
        self.Box_scale = QtWidgets.QComboBox(self.tab)
        self.Box_scale.setGeometry(QtCore.QRect(20, 140, 71, 41))
        self.Box_scale.setObjectName("Box_scale")
        self.Box_scale.addItem("")
        self.Box_scale.addItem("")
        self.Box_scale.addItem("")
        self.Box_cache = QtWidgets.QComboBox(self.tab)
        self.Box_cache.setGeometry(QtCore.QRect(240, 140, 71, 41))
        self.Box_cache.setObjectName("Box_cache")
        self.Box_cache.addItem("")
        self.Box_cache.addItem("")
        self.Box_cache.addItem("")
        self.Box_cache.addItem("")
        self.Box_half = QtWidgets.QComboBox(self.tab)
        self.Box_half.setGeometry(QtCore.QRect(450, 140, 91, 41))
        self.Box_half.setObjectName("Box_half")
        self.Box_half.addItem("")
        self.Box_half.addItem("")
        self.Box_tile = QtWidgets.QComboBox(self.tab)
        self.Box_tile.setGeometry(QtCore.QRect(130, 140, 71, 41))
        self.Box_tile.setObjectName("Box_tile")
        self.Box_tile.addItem("")
        self.Box_tile.addItem("")
        self.Box_tile.addItem("")
        self.Box_tile.addItem("")
        self.Box_tile.addItem("")
        self.Box_tile.addItem("")
        self.label_half = QtWidgets.QLabel(self.tab)
        self.label_half.setGeometry(QtCore.QRect(460, 110, 71, 31))
        self.label_half.setObjectName("label_half")
        self.label_tile = QtWidgets.QLabel(self.tab)
        self.label_tile.setGeometry(QtCore.QRect(130, 110, 71, 31))
        self.label_tile.setObjectName("label_tile")
        self.number_alpha = QtWidgets.QDoubleSpinBox(self.tab)
        self.number_alpha.setGeometry(QtCore.QRect(350, 140, 71, 41))
        self.number_alpha.setMaximum(2.0)
        self.number_alpha.setSingleStep(0.1)
        self.number_alpha.setProperty("value", 1.0)
        self.number_alpha.setObjectName("number_alpha")
        self.tabWidget.addTab(self.tab, "")
        self.tab_2 = QtWidgets.QWidget()
        self.tab_2.setObjectName("tab_2")
        self.Box_preset = QtWidgets.QComboBox(self.tab_2)
        self.Box_preset.setGeometry(QtCore.QRect(10, 230, 111, 41))
        self.Box_preset.setObjectName("Box_preset")
        self.Box_preset.addItem("")
        self.Box_preset.addItem("")
        self.Box_preset.addItem("")
        self.Box_preset.addItem("")
        self.Box_preset.addItem("")
        self.Box_preset.addItem("")
        self.Box_preset.addItem("")
        self.Box_preset.addItem("")
        self.Box_preset.addItem("")
        self.Box_preset.addItem("")
        self.Box_yuv = QtWidgets.QComboBox(self.tab_2)
        self.Box_yuv.setGeometry(QtCore.QRect(230, 40, 131, 41))
        self.Box_yuv.setObjectName("Box_yuv")
        self.Box_yuv.addItem("")
        self.Box_yuv.addItem("")
        self.Box_yuv.addItem("")
        self.Box_yuv.addItem("")
        self.label_encode = QtWidgets.QLabel(self.tab_2)
        self.label_encode.setGeometry(QtCore.QRect(10, 10, 171, 31))
        self.label_encode.setObjectName("label_encode")
        self.label_preset = QtWidgets.QLabel(self.tab_2)
        self.label_preset.setGeometry(QtCore.QRect(10, 200, 71, 31))
        self.label_preset.setObjectName("label_preset")
        self.encode_vcode = QtWidgets.QComboBox(self.tab_2)
        self.encode_vcode.setGeometry(QtCore.QRect(10, 40, 171, 41))
        self.encode_vcode.setObjectName("encode_vcode")
        self.encode_vcode.addItem("")
        self.encode_vcode.addItem("")
        self.encode_vcode.addItem("")
        self.encode_vcode.addItem("")
        self.encode_vcode.addItem("")
        self.encode_vcode.addItem("")
        self.encode_vcode.addItem("")
        self.encode_vcode.addItem("")
        self.encode_vcode.addItem("")
        self.label_yuv = QtWidgets.QLabel(self.tab_2)
        self.label_yuv.setGeometry(QtCore.QRect(230, 10, 71, 31))
        self.label_yuv.setObjectName("label_yuv")
        self.lineEdit_free = QtWidgets.QLineEdit(self.tab_2)
        self.lineEdit_free.setGeometry(QtCore.QRect(10, 320, 541, 41))
        self.lineEdit_free.setObjectName("lineEdit_free")
        self.label_free = QtWidgets.QLabel(self.tab_2)
        self.label_free.setGeometry(QtCore.QRect(20, 280, 161, 31))
        self.label_free.setObjectName("label_free")
        self.Button_CRF = QtWidgets.QRadioButton(self.tab_2)
        self.Button_CRF.setGeometry(QtCore.QRect(10, 110, 121, 31))
        self.Button_CRF.setChecked(True)
        self.Button_CRF.setObjectName("Button_CRF")
        self.Button_Bitrate = QtWidgets.QRadioButton(self.tab_2)
        self.Button_Bitrate.setGeometry(QtCore.QRect(10, 150, 121, 31))
        self.Button_Bitrate.setObjectName("Button_Bitrate")
        self.lineEdit_CRF = QtWidgets.QLineEdit(self.tab_2)
        self.lineEdit_CRF.setGeometry(QtCore.QRect(150, 110, 171, 31))
        self.lineEdit_CRF.setObjectName("lineEdit_CRF")
        self.lineEdit_Bitrate = QtWidgets.QLineEdit(self.tab_2)
        self.lineEdit_Bitrate.setGeometry(QtCore.QRect(150, 150, 171, 31))
        self.lineEdit_Bitrate.setObjectName("lineEdit_Bitrate")
        self.Box_profile = QtWidgets.QComboBox(self.tab_2)
        self.Box_profile.setGeometry(QtCore.QRect(400, 40, 101, 41))
        self.Box_profile.setObjectName("Box_profile")
        self.Box_profile.addItem("")
        self.Box_profile.addItem("")
        self.label_profile = QtWidgets.QLabel(self.tab_2)
        self.label_profile.setGeometry(QtCore.QRect(400, 10, 71, 31))
        self.label_profile.setObjectName("label_profile")
        self.label_format = QtWidgets.QLabel(self.tab_2)
        self.label_format.setGeometry(QtCore.QRect(150, 200, 111, 31))
        self.label_format.setObjectName("label_format")
        self.Box_format = QtWidgets.QComboBox(self.tab_2)
        self.Box_format.setGeometry(QtCore.QRect(150, 230, 111, 41))
        self.Box_format.setObjectName("Box_format")
        self.Box_format.addItem("")
        self.Box_format.addItem("")
        self.Box_format.addItem("")
        self.tabWidget.addTab(self.tab_2, "")
        self.gridLayout.addWidget(self.tabWidget, 0, 1, 1, 1)
        self.verticalLayout_2.addWidget(self.widget_2)
        self.widget_3 = QtWidgets.QWidget(self.widget_4)
        self.widget_3.setObjectName("widget_3")
        self.gridLayout_2 = QtWidgets.QGridLayout(self.widget_3)
        self.gridLayout_2.setObjectName("gridLayout_2")
        self.label_message = QtWidgets.QLabel(self.widget_3)
        self.label_message.setObjectName("label_message")
        self.gridLayout_2.addWidget(self.label_message, 0, 0, 1, 1)
        self.Button_start = QtWidgets.QPushButton(self.widget_3)
        self.Button_start.setMinimumSize(QtCore.QSize(200, 150))
        self.Button_start.setObjectName("Button_start")
        self.gridLayout_2.addWidget(self.Button_start, 1, 1, 1, 1)
        self.textBrowser = QtWidgets.QTextBrowser(self.widget_3)
        self.textBrowser.setObjectName("textBrowser")
        self.gridLayout_2.addWidget(self.textBrowser, 1, 0, 1, 1)
        self.verticalLayout_2.addWidget(self.widget_3)
        self.horizontalLayout.addWidget(self.widget_4)

        self.retranslateUi(Form)
        self.tabWidget.setCurrentIndex(0)
        QtCore.QMetaObject.connectSlotsByName(Form)

    def retranslateUi(self, Form):
        _translate = QtCore.QCoreApplication.translate
        Form.setWindowTitle(_translate("Form", "AUST 1.0 By NangInShell"))
        self.label_input.setText(_translate("Form", "输入路径(直接拖入视频)"))
        self.label_output.setText(_translate("Form", "输出路径(暂时没效果,默认保存到原视频同目录)"))
        self.label_device.setText(_translate("Form", "超分GPU"))
        self.label_model.setText(_translate("Form", "模型选择"))
        self.Box_method.setItemText(0, _translate("Form", "Real_Cugan"))
        self.Box_model.setItemText(0, _translate("Form", "pro-conservative-up2x.pth"))
        self.Box_model.setItemText(1, _translate("Form", "pro-conservative-up3x.pth"))
        self.Box_model.setItemText(2, _translate("Form", "pro-denoise3x-up2x.pth"))
        self.Box_model.setItemText(3, _translate("Form", "pro-denoise3x-up3x.pth"))
        self.Box_model.setItemText(4, _translate("Form", "pro-no-denoise3x-up2x.pth"))
        self.Box_model.setItemText(5, _translate("Form", "pro-no-denoise3x-up3x.pth"))
        self.Box_model.setItemText(6, _translate("Form", "up2x-latest-conservative.pth"))
        self.Box_model.setItemText(7, _translate("Form", "up2x-latest-denoise1x.pth"))
        self.Box_model.setItemText(8, _translate("Form", "up2x-latest-denoise2x.pth"))
        self.Box_model.setItemText(9, _translate("Form", "up2x-latest-denoise3x.pth"))
        self.Box_model.setItemText(10, _translate("Form", "up2x-latest-no-denoise.pth"))
        self.Box_model.setItemText(11, _translate("Form", "up3x-latest-conservative.pth"))
        self.Box_model.setItemText(12, _translate("Form", "up3x-latest-denoise3x.pth"))
        self.Box_model.setItemText(13, _translate("Form", "up3x-latest-no-denoise.pth"))
        self.Box_model.setItemText(14, _translate("Form", "up4x-latest-conservative.pth"))
        self.Box_model.setItemText(15, _translate("Form", "up4x-latest-denoise3x.pth"))
        self.Box_model.setItemText(16, _translate("Form", "up4x-latest-no-denoise.pth"))
        self.label_method.setText(_translate("Form", "算法选择"))
        self.label_scale.setText(_translate("Form", "超分倍数"))
        self.label_alpha.setText(_translate("Form", "alpha"))
        self.label_cache.setText(_translate("Form", "cache"))
        self.Box_scale.setItemText(0, _translate("Form", "2"))
        self.Box_scale.setItemText(1, _translate("Form", "3"))
        self.Box_scale.setItemText(2, _translate("Form", "4"))
        self.Box_cache.setItemText(0, _translate("Form", "0"))
        self.Box_cache.setItemText(1, _translate("Form", "1"))
        self.Box_cache.setItemText(2, _translate("Form", "2"))
        self.Box_cache.setItemText(3, _translate("Form", "3"))
        self.Box_half.setItemText(0, _translate("Form", "False"))
        self.Box_half.setItemText(1, _translate("Form", "True"))
        self.Box_tile.setItemText(0, _translate("Form", "3"))
        self.Box_tile.setItemText(1, _translate("Form", "0"))
        self.Box_tile.setItemText(2, _translate("Form", "1"))
        self.Box_tile.setItemText(3, _translate("Form", "2"))
        self.Box_tile.setItemText(4, _translate("Form", "4"))
        self.Box_tile.setItemText(5, _translate("Form", "5"))
        self.label_half.setText(_translate("Form", "半精度开关"))
        self.label_tile.setText(_translate("Form", "tile"))
        self.tabWidget.setTabText(self.tabWidget.indexOf(self.tab), _translate("Form", "超分设置"))
        self.Box_preset.setItemText(0, _translate("Form", "slow"))
        self.Box_preset.setItemText(1, _translate("Form", "ultrafast"))
        self.Box_preset.setItemText(2, _translate("Form", "superfast"))
        self.Box_preset.setItemText(3, _translate("Form", "veryfast"))
        self.Box_preset.setItemText(4, _translate("Form", "faster"))
        self.Box_preset.setItemText(5, _translate("Form", "fast"))
        self.Box_preset.setItemText(6, _translate("Form", "medium"))
        self.Box_preset.setItemText(7, _translate("Form", "slower"))
        self.Box_preset.setItemText(8, _translate("Form", "veryslow"))
        self.Box_preset.setItemText(9, _translate("Form", "placebo"))
        self.Box_yuv.setItemText(0, _translate("Form", "yuv420p10le"))
        self.Box_yuv.setItemText(1, _translate("Form", "yuv444p10le"))
        self.Box_yuv.setItemText(2, _translate("Form", "yuv420p"))
        self.Box_yuv.setItemText(3, _translate("Form", "yuv444p"))
        self.label_encode.setText(_translate("Form", "编码器+编码格式"))
        self.label_preset.setText(_translate("Form", "压制预设"))
        self.encode_vcode.setItemText(0, _translate("Form", "libx265"))
        self.encode_vcode.setItemText(1, _translate("Form", "libx264"))
        self.encode_vcode.setItemText(2, _translate("Form", "hevc_nvenc"))
        self.encode_vcode.setItemText(3, _translate("Form", "h264_nvenc"))
        self.encode_vcode.setItemText(4, _translate("Form", "hevc_qsv"))
        self.encode_vcode.setItemText(5, _translate("Form", "h264_qsv"))
        self.encode_vcode.setItemText(6, _translate("Form", "prores"))
        self.encode_vcode.setItemText(7, _translate("Form", "prores_aw"))
        self.encode_vcode.setItemText(8, _translate("Form", "prores_ks"))
        self.label_yuv.setText(_translate("Form", "yuv格式"))
        self.label_free.setText(_translate("Form", "自定义压制参数"))
        self.Button_CRF.setText(_translate("Form", "CRF质量"))
        self.Button_Bitrate.setText(_translate("Form", "目标码率(M)"))
        self.lineEdit_CRF.setText(_translate("Form", "16"))
        self.lineEdit_Bitrate.setText(_translate("Form", "10"))
        self.Box_profile.setItemText(0, _translate("Form", "main10"))
        self.Box_profile.setItemText(1, _translate("Form", "main"))
        self.label_profile.setText(_translate("Form", "配置参数"))
        self.label_format.setText(_translate("Form", "输出文件格式"))
        self.Box_format.setItemText(0, _translate("Form", "mp4"))
        self.Box_format.setItemText(1, _translate("Form", "mkv"))
        self.Box_format.setItemText(2, _translate("Form", "mov"))
        self.tabWidget.setTabText(self.tabWidget.indexOf(self.tab_2), _translate("Form", "压制设置"))
        self.label_message.setText(_translate("Form", "信息框"))
        self.Button_start.setText(_translate("Form", "一键启动"))

        nvmlInit()
        deviceCount = nvmlDeviceGetCount()

        for i in range(deviceCount):
            handle = nvmlDeviceGetHandleByIndex(i)
            device = (str(i) + ":" + str(nvmlDeviceGetName(handle)))
            self.Box_device.addItem(device)


#输入路径可多个拖拽输入
class MListWidget(QtWidgets.QListWidget):
    def __init__(self, parent: Optional[QWidget]=None) -> None:
        super().__init__(parent)
        # 拖拽设置
        self.setAcceptDrops(True)
        self.setDragEnabled(True)
        self.setDragDropMode(QAbstractItemView.DragDrop)            # 设置拖放
        self.setSelectionMode(QAbstractItemView.ExtendedSelection)  # 设置选择多个
        self.setDefaultDropAction(Qt.CopyAction)

    def dragEnterEvent(self, e: QDragEnterEvent) -> None:
        """（从外部或内部控件）拖拽进入后触发的事件"""
        # print(e.mimeData().text())
        if e.mimeData().hasText():
            if e.mimeData().text().startswith('file:///'):
                e.accept()
        else:
            e.ignore()

    def dragMoveEvent(self, e: QDragMoveEvent) -> None:
        """拖拽移动过程中触发的事件"""
        e.accept()

    def dropEvent(self, e: QDropEvent) -> None:
        """拖拽结束以后触发的事件"""
        paths = e.mimeData().text().split('\n')
        for path in paths:
            path = path.strip()
            if len(path) > 8:
                self.addItem(path.strip()[8:])
        e.accept()


class MLineEdit(QtWidgets.QLineEdit):#实现可拖拽导入输出路径
    def __init__(self, title):
        super().__init__(title)
        self.setAcceptDrops(True)

    def dragEnterEvent(self, e):
        if e.mimeData().hasText():
            e.accept()
        else:
            e.ignore()

    def dropEvent(self, e):
        filePathList = e.mimeData().text()
        filePath = filePathList.split('\n')[0] #拖拽多文件只取第一个地址
        filePath = filePath.replace('file:///', '', 1) #去除文件地址前缀的特定字符
        self.setText(filePath)